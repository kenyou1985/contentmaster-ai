# 🔍 API Key 验证问题排查指南

## 如果验证失败，请按以下步骤排查：

### 1. 检查浏览器控制台
1. 按 `F12` 打开开发者工具
2. 切换到 `Console`（控制台）标签
3. 查看是否有红色错误信息
4. 特别关注：
   - CORS 错误
   - 网络连接错误
   - 401/403 认证错误
   - 404 模型不存在错误

### 2. 检查 API Key 格式
- **Yunwu AI**: 应该以 `sk-` 开头
- **Google 官方**: 应该以 `AIza` 开头
- 确保没有多余的空格或换行符

### 3. 检查 Base URL 配置
- **Yunwu AI**: 应该是 `https://api.yunwu.ai`
- **Google 官方**: 应该是 `https://generativelanguage.googleapis.com`
- 确保 URL 没有末尾斜杠 `/`

### 4. 常见错误及解决方案

#### 错误：網絡連接失敗
**可能原因**：
- 网络不稳定
- Base URL 配置错误
- CORS 限制（浏览器安全策略）

**解决方案**：
1. 检查网络连接
2. 确认 Base URL 是否正确
3. 如果使用 Yunwu AI，确保 Base URL 为 `https://api.yunwu.ai`
4. 检查浏览器控制台的详细错误

#### 错误：API Key 無效或未授權
**可能原因**：
- API Key 输入错误
- API Key 已过期
- API Key 没有相应权限

**解决方案**：
1. 重新复制 API Key（注意不要有多余空格）
2. 在 Yunwu AI 控制台检查 API Key 状态
3. 确认 API Key 有访问 Gemini API 的权限

#### 错误：所有模型都無法使用
**可能原因**：
- API Key 无效
- Base URL 配置错误
- 网络问题

**解决方案**：
1. 检查 API Key 和 Base URL
2. 尝试使用不同的模型
3. 查看浏览器控制台的详细错误

### 5. 验证流程说明

验证过程会：
1. 首先尝试使用 `gemini-2.0-flash-exp` 模型
2. 如果失败，尝试 `gemini-3-pro-preview-thinking` 模型
3. 每个模型有 10 秒超时限制
4. 如果所有模型都失败，返回错误信息

### 6. 调试技巧

#### 查看详细日志
验证过程中会在浏览器控制台输出详细日志：
- `[Validation] Auto-detected Yunwu AI from sk- prefix`
- `[Validation] Using Base URL: ...`
- `[Validation] Trying model: ...`
- `[Validation] Success with model: ...`

#### 手动测试 API
如果验证一直失败，可以：
1. 打开浏览器控制台
2. 查看 Network（网络）标签
3. 点击"驗證 Key"按钮
4. 查看发送的请求和响应

### 7. 临时解决方案

如果验证失败但您确定 API Key 是正确的：
1. 可以暂时跳过验证
2. 直接尝试生成内容
3. 如果生成时出错，错误信息会更具体

### 8. 联系支持

如果以上方法都无法解决问题：
1. 截图浏览器控制台的错误信息
2. 记录使用的 API Key 前缀（不泄露完整 Key）
3. 记录 Base URL 配置
4. 联系 Yunwu AI 客服或查看 [API 文档](https://yunwu.apifox.cn/)

---

**提示**：验证失败不一定意味着 API Key 无效，可能是临时的网络问题。如果确定 API Key 正确，可以尝试直接使用功能。
