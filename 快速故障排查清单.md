# YouTube 字幕提取 - 快速故障排查清单

## 🔴 当前错误：405 Method Not Allowed + CORS 错误

### ✅ 检查清单（按顺序逐项检查）

#### 1️⃣ 检查 Google Apps Script 部署权限 ⚠️ 最关键

- [ ] 打开 https://script.google.com/
- [ ] 找到您的项目：`YouTube字幕提取API`
- [ ] 点击 **"部署"** → **"管理部署"**
- [ ] 查看 **"有权访问该应用的用户"** 设置
- [ ] ✅ **必须是"任何人"**
- [ ] ❌ 如果是"仅我自己"或"仅限组织"，这就是问题所在！

**如何修复**：
1. 点击当前部署右侧的 **"编辑"** 图标（铅笔）
2. 将 **"有权访问该应用的用户"** 改为 **"任何人"**
3. 点击 **"部署"**
4. ⚠️ 复制新的 URL（URL 会变化！）
5. 将新 URL 更新到 `components/Tools.tsx` 第 20 行

---

#### 2️⃣ 检查 API URL 格式

- [ ] 您的 URL：`_______________________________________________`
- [ ] URL 是否以 `/exec` 结尾？✅ 是 / ❌ 否
- [ ] URL 格式类似：`https://script.google.com/macros/s/AKfycby.../exec`

**如果不是**：
- 重新复制正确的 URL（部署页面中的"网络应用"URL）

---

#### 3️⃣ 测试 API 是否可访问（GET 请求）

- [ ] 打开浏览器
- [ ] 访问：`您的URL?videoId=UyyjU8fzEYU`
- [ ] 是否显示 JSON 数据？✅ 是 / ❌ 否

**期望结果**：
```json
{
  "success": true,
  "transcript": "视频字幕内容...",
  "videoId": "UyyjU8fzEYU"
}
```

**如果失败**：
- 返回错误 1（检查权限设置）

---

#### 4️⃣ 检查前端配置

- [ ] 打开 `components/Tools.tsx` 文件
- [ ] 找到第 20 行
- [ ] 确认 URL 配置正确：
```typescript
const [gasApiUrl, setGasApiUrl] = useState<string>('您的完整URL');
```
- [ ] ⚠️ 如果修改了代码，必须重启开发服务器：
  1. 终端按 `Ctrl+C` 停止
  2. 运行 `npm run dev` 重新启动
  3. 浏览器按 `Ctrl+Shift+R` 强制刷新

---

#### 5️⃣ 检查 Google Apps Script 代码

- [ ] 打开 https://script.google.com/
- [ ] 找到您的项目
- [ ] 确认代码中包含 `doPost` 函数
- [ ] 确认代码中包含 `doGet` 函数

**如果没有**：
- 复制 `GAS_完整代码_支持CORS.gs` 中的代码
- 粘贴到 Google Apps Script 编辑器
- 点击 **"保存"**
- 重新部署（参考步骤 1）

---

#### 6️⃣ 检查浏览器控制台（F12）

- [ ] 打开浏览器开发者工具（F12）
- [ ] 切换到 **Console** 标签
- [ ] 查找错误信息

**常见错误及解决方案**：

| 错误信息 | 原因 | 解决方案 |
|---------|------|---------|
| `405 Method Not Allowed` | 权限设置错误 | 返回步骤 1 |
| `CORS policy` | 权限设置错误 | 返回步骤 1 |
| `Failed to fetch` | URL 错误或网络问题 | 检查步骤 2 和 3 |
| `未配置GAS API` | 前端配置错误 | 检查步骤 4 |
| `未找到字幕` | 视频没有字幕 | 换一个有字幕的视频 |

---

## 📊 测试视频推荐

以下视频确认有字幕，可用于测试：

1. **TED 演讲**（英文字幕）
   - URL: `https://www.youtube.com/watch?v=UyyjU8fzEYU`
   - Video ID: `UyyjU8fzEYU`

2. **经典 MV**（多语言字幕）
   - URL: `https://www.youtube.com/watch?v=dQw4w9WgXcQ`
   - Video ID: `dQw4w9WgXcQ`

3. **教程视频**（中文字幕）
   - URL: `https://www.youtube.com/watch?v=9bZkp7q19f0`
   - Video ID: `9bZkp7q19f0`

---

## 🆘 还是不行？请提供以下信息

### 1. 浏览器控制台截图（F12 → Console 标签）
- 显示完整的错误信息
- 包括红色错误和黄色警告

### 2. 网络请求详情（F12 → Network 标签）
- 找到 `exec` 请求（红色的那个）
- 点击查看详情
- 截图 **Headers** 标签（包括 Request URL、Status Code）
- 截图 **Response** 标签（如果有内容）

### 3. Google Apps Script 部署配置截图
- 打开 **"部署"** → **"管理部署"**
- 截图权限设置部分

### 4. 当前配置信息
- API URL：`_______________________________________`
- 是否选择"任何人"权限：✅ 是 / ❌ 否 / ❓ 不确定
- GET 测试是否成功：✅ 是 / ❌ 否
- 浏览器类型：Chrome / Edge / Firefox / Safari / 其他

---

## 💡 快速提示

1. **90% 的问题都是权限设置错误**
   - 确保选择"任何人"，不是"仅我自己"

2. **URL 必须以 `/exec` 结尾**
   - 不是 `/dev`，不是其他

3. **修改代码后必须重启服务器**
   - `Ctrl+C` → `npm run dev` → `Ctrl+Shift+R`

4. **先测试 GET 请求，再测试前端**
   - 浏览器直接访问 `URL?videoId=UyyjU8fzEYU`
   - 如果 GET 成功，问题在前端配置
   - 如果 GET 失败，问题在 GAS 部署

5. **清除浏览器缓存**
   - 按 `Ctrl+Shift+Delete`
   - 选择"缓存的图片和文件"
   - 点击"清除数据"
   - 按 `Ctrl+F5` 强制刷新
