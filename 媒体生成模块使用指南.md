# 媒体生成模块使用指南

## 📋 功能概述

媒体生成模块可以：
- ✅ 自动读取或手动上传改写工具生成的脚本
- ✅ 解析脚本，提取图片提示词和视频提示词
- ✅ 支持编辑和修改提示词
- ✅ 调用 yunwu.ai API 生成图片和视频
- ✅ 支持单个或批量生成
- ✅ 支持多种主流图片和视频模型

---

## 🚀 快速开始

### 第1步：生成脚本

1. 切换到「改寫工具」标签
2. 选择「腳本輸出」模式
3. 输入或粘贴内容
4. 点击「生成」
5. 等待脚本生成完成

### 第2步：读取脚本

1. 切换到「媒體生成」标签
2. 点击「从改写工具读取」按钮
3. 脚本会自动填充到输入框
4. 系统自动解析镜头信息

### 第3步：生成媒体

1. 选择图片生成模型（如 DALL·E 3）
2. 选择视频生成模型（如 Veo 3）
3. 点击「批量生成图片」或「批量生成视频」
4. 等待生成完成
5. 查看和下载结果

---

## 📝 脚本格式要求

脚本必须包含以下格式的镜头信息：

```
镜头1
镜头文案: [角色名]-[语气词]："[文案内容]"
图片提示词: [景别], [画面描述], [环境描述]
视频提示词: [秒数]s: [画面描述], [运镜方式]
景别: [全景/中景/特写]
语音分镜: [角色名]
音效: [音效名]

镜头2
...
```

---

## 🎨 支持的图片模型

| 模型 | 说明 |
|------|------|
| DALL·E 3 | OpenAI 官方图片生成模型 |
| GPT Image 1 | GPT 图片生成模型 |
| GPT Image 1.5 | GPT 图片生成模型（升级版）|
| Flux 1 Dev | Flux 开发版 |
| Flux 1 Schnell | Flux 快速版 |
| Flux Pro | Flux 专业版 |
| Flux Kontext Max | Flux Kontext 最大版 |
| Ideogram 3.0 | Ideogram 3.0 模型 |

---

## 🎬 支持的视频模型

| 模型 | 说明 |
|------|------|
| Veo 3 | Google Veo 3 视频生成 |
| Veo 3 Fast | Veo 3 快速版 |
| Kling Video v2.5 | Kling 视频生成 v2.5 |
| Seedream v4 | Seedream v4 视频生成 |

---

## 🔧 功能详解

### 1. 脚本输入方式

**方式A：从改写工具读取**
- 点击「从改写工具读取」按钮
- 自动从 localStorage 读取最新生成的脚本

**方式B：手动上传**
- 点击「上传脚本」按钮
- 选择 .txt 或 .md 文件
- 自动解析脚本内容

**方式C：手动粘贴**
- 直接在输入框中粘贴脚本内容
- 系统自动解析

### 2. 镜头编辑

- 点击镜头卡片右上角的「编辑」图标
- 修改图片提示词或视频提示词
- 点击「保存」完成编辑

### 3. 单个生成

- 在每个镜头卡片中点击「生成图片」或「生成视频」
- 实时显示生成状态
- 生成完成后显示预览和下载链接

### 4. 批量生成

- 点击「批量生成图片」：为所有有图片提示词的镜头生成图片
- 点击「批量生成视频」：为所有有视频提示词的镜头生成视频
- 自动添加延迟避免 API 限流

---

## ⚙️ API 配置

### 使用 yunwu.ai API

1. 在顶部设置中配置 API Key（sk- 开头）
2. 确保 API Key 有足够的额度
3. 参考 [yunwu.ai API 文档](https://yunwu.apifox.cn/)

### API 费用

- 不同模型的费用不同
- 建议先测试单个生成，确认效果后再批量生成
- 查看 yunwu.ai 控制台了解详细费用

---

## 💡 使用技巧

### 提示词优化

1. **图片提示词**：
   - 包含景别（全景/中景/特写）
   - 详细描述画面内容
   - 描述环境氛围
   - 示例：`中景, 一位中年男性医生坐在古色古香的书房中, 背景有书架和医学图谱, 柔和的光线`

2. **视频提示词**：
   - 包含时长和画面描述
   - 描述运镜方式
   - 示例：`8s: 医生平静讲述, 固定机位`

### 批量生成建议

- 先测试1-2个镜头，确认效果
- 批量生成时注意 API 额度
- 建议分批生成，避免一次性生成过多

### 脚本格式检查

- 确保每个镜头都有「镜头X」标记
- 确保提示词格式正确
- 如果解析失败，检查脚本格式

---

## 🐛 常见问题

### Q1: 解析不到镜头信息？

**A**: 检查脚本格式是否正确，确保：
- 每个镜头以「镜头X」开头
- 字段格式为「图片提示词: ...」
- 字段名后使用中文冒号「：」或英文冒号「:」

### Q2: 生成失败？

**A**: 检查：
- API Key 是否正确配置
- API Key 是否有足够额度
- 网络连接是否正常
- 提示词是否符合模型要求

### Q3: 如何修改提示词？

**A**: 
- 点击镜头卡片右上角的「编辑」图标
- 修改提示词内容
- 点击「保存」

### Q4: 支持哪些文件格式？

**A**: 
- 支持 .txt 和 .md 文件
- 也可以直接粘贴文本

---

## 📞 技术支持

如有问题，请：
1. 检查浏览器控制台错误信息
2. 查看 yunwu.ai API 文档
3. 确认 API Key 配置正确

---

## 🎯 后续优化计划

- [ ] 支持更多图片和视频模型
- [ ] 添加生成进度条
- [ ] 支持任务队列管理
- [ ] 添加生成历史记录
- [ ] 支持批量下载
- [ ] 优化 UI 交互体验
