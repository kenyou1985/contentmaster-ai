<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sora è§†é¢‘ç”Ÿæˆ API æµ‹è¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      padding: 30px;
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 24px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    
    textarea {
      min-height: 100px;
      font-family: 'Courier New', monospace;
      resize: vertical;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    button {
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: #667eea;
      color: white;
    }
    
    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }
    
    .btn-secondary:hover {
      background: #e0e0e0;
    }
    
    .result {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 6px;
      border-left: 4px solid #667eea;
    }
    
    .result h3 {
      margin-bottom: 10px;
      color: #333;
      font-size: 16px;
    }
    
    .result pre {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 12px;
      line-height: 1.5;
    }
    
    .success {
      border-left-color: #28a745;
      background: #d4edda;
    }
    
    .error {
      border-left-color: #dc3545;
      background: #f8d7da;
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 13px;
      color: #1976D2;
    }
    
    .info-box strong {
      display: block;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¬ Sora è§†é¢‘ç”Ÿæˆ API æµ‹è¯•å·¥å…·</h1>
    <p class="subtitle">æµ‹è¯• yunwu.ai Sora è§†é¢‘ç”Ÿæˆæ¥å£é…ç½®</p>
    
    <div class="info-box">
      <strong>ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š</strong>
      1. å¡«å†™ä½ çš„ yunwu.ai API Key<br>
      2. é€‰æ‹©æµ‹è¯•æ¨¡å¼ï¼ˆæ–‡ç”Ÿè§†é¢‘æˆ–å›¾ç”Ÿè§†é¢‘ï¼‰<br>
      3. å¡«å†™å¿…è¦çš„å‚æ•°<br>
      4. ç‚¹å‡»"å¼€å§‹æµ‹è¯•"æŒ‰é’®
    </div>
    
    <form id="testForm">
      <div class="form-group">
        <label for="apiKey">API Key *</label>
        <input type="text" id="apiKey" placeholder="è¾“å…¥ä½ çš„ yunwu.ai API Key" required>
      </div>
      
      <div class="form-group">
        <label for="testMode">æµ‹è¯•æ¨¡å¼ *</label>
        <select id="testMode" required>
          <option value="text-to-video">æ–‡ç”Ÿè§†é¢‘ (Text-to-Video)</option>
          <option value="image-to-video">å›¾ç”Ÿè§†é¢‘ (Image-to-Video)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="model">æ¨¡å‹ *</label>
        <select id="model" required>
          <option value="sora-2">Sora 2</option>
          <option value="sora-2-pro">Sora 2 Pro</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="prompt">è§†é¢‘æç¤ºè¯ *</label>
        <textarea id="prompt" placeholder="ä¾‹å¦‚: A beautiful sunset over the ocean, waves gently crashing on the shore, cinematic quality" required></textarea>
      </div>
      
      <div class="form-group" id="imageUrlGroup" style="display: none;">
        <label for="imageUrl">å›¾ç‰‡ URLï¼ˆå›¾ç”Ÿè§†é¢‘éœ€è¦ï¼‰</label>
        <input type="url" id="imageUrl" placeholder="https://example.com/your-image.jpg">
        <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„å›¾ç‰‡ URL</small>
      </div>
      
      <div class="form-group">
        <label for="orientation">è§†é¢‘æ–¹å‘ *</label>
        <select id="orientation" required>
          <option value="landscape">æ¨ªå± (Landscape)</option>
          <option value="portrait">ç«–å± (Portrait)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="size">è§†é¢‘åˆ†è¾¨ç‡ *</label>
        <select id="size" required>
          <option value="small">720P (Small)</option>
          <option value="large" selected>1080P (Large)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="duration">è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰*</label>
        <select id="duration" required>
          <option value="10" selected>10 ç§’</option>
          <option value="15">15 ç§’</option>
          <option value="25">25 ç§’</option>
        </select>
      </div>
      
      <div class="button-group">
        <button type="submit" class="btn-primary" id="submitBtn">ğŸš€ å¼€å§‹æµ‹è¯•</button>
        <button type="button" class="btn-secondary" onclick="clearResult()">æ¸…é™¤ç»“æœ</button>
      </div>
    </form>
    
    <div id="result" style="display: none;"></div>
  </div>
  
  <script>
    const BASE_URL = 'https://yunwu.ai';
    
    // åˆ‡æ¢æµ‹è¯•æ¨¡å¼æ—¶æ˜¾ç¤º/éšè—å›¾ç‰‡ URL è¾“å…¥æ¡†
    document.getElementById('testMode').addEventListener('change', function(e) {
      const imageUrlGroup = document.getElementById('imageUrlGroup');
      if (e.target.value === 'image-to-video') {
        imageUrlGroup.style.display = 'block';
        document.getElementById('imageUrl').required = true;
      } else {
        imageUrlGroup.style.display = 'none';
        document.getElementById('imageUrl').required = false;
      }
    });
    
    // è¡¨å•æäº¤
    document.getElementById('testForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const resultDiv = document.getElementById('result');
      
      // è·å–è¡¨å•æ•°æ®
      const apiKey = document.getElementById('apiKey').value.trim();
      const testMode = document.getElementById('testMode').value;
      const model = document.getElementById('model').value;
      const prompt = document.getElementById('prompt').value.trim();
      const imageUrl = document.getElementById('imageUrl').value.trim();
      const orientation = document.getElementById('orientation').value;
      const size = document.getElementById('size').value;
      const duration = parseInt(document.getElementById('duration').value);
      
      // éªŒè¯
      if (!apiKey) {
        showResult('error', 'é”™è¯¯', 'è¯·å¡«å†™ API Key');
        return;
      }
      
      if (testMode === 'image-to-video' && !imageUrl) {
        showResult('error', 'é”™è¯¯', 'å›¾ç”Ÿè§†é¢‘æ¨¡å¼éœ€è¦æä¾›å›¾ç‰‡ URL');
        return;
      }
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="loading"></span>æµ‹è¯•ä¸­...';
      resultDiv.style.display = 'none';
      
      // æ„å»ºè¯·æ±‚ä½“
      const requestBody = {
        model: model,
        prompt: prompt,
        orientation: orientation,
        size: size,
        duration: duration,
        watermark: true,
      };
      
      // å›¾ç”Ÿè§†é¢‘æ¨¡å¼ï¼šæ·»åŠ  images å­—æ®µ
      if (testMode === 'image-to-video') {
        requestBody.images = [imageUrl];
      }
      
      // å‘é€è¯·æ±‚
      try {
        const response = await fetch(`${BASE_URL}/v1/video/create`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`,
          },
          body: JSON.stringify(requestBody),
        });
        
        const responseText = await response.text();
        let responseData;
        
        try {
          responseData = JSON.parse(responseText);
        } catch {
          responseData = { raw: responseText };
        }
        
        if (response.ok) {
          showResult('success', 'âœ… è¯·æ±‚æˆåŠŸï¼', {
            status: response.status,
            statusText: response.statusText,
            data: responseData,
            requestBody: requestBody,
          });
          
          if (responseData.id || responseData.task_id) {
            console.log('ä»»åŠ¡ ID:', responseData.id || responseData.task_id);
            console.log('ğŸ’¡ æç¤º: å¦‚æœè¿”å›äº† task_idï¼Œéœ€è¦ä½¿ç”¨è½®è¯¢æ¥å£æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€');
          }
          
          if (responseData.url || responseData.video_url) {
            console.log('è§†é¢‘ URL:', responseData.url || responseData.video_url);
          }
        } else {
          // æ£€æŸ¥æ˜¯å¦æ˜¯æœåŠ¡å™¨è´Ÿè½½é”™è¯¯
          const isLoadError = response.status === 500 || 
            (responseData.error && (
              typeof responseData.error === 'string' && (
                responseData.error.includes('è´Ÿè½½å·²é¥±å’Œ') || 
                responseData.error.includes('saturated') ||
                responseData.error.includes('è´Ÿè½½')
              )
            )) ||
            (responseData.error && typeof responseData.error === 'object' && responseData.error.error && (
              responseData.error.error.includes('è´Ÿè½½å·²é¥±å’Œ') || 
              responseData.error.error.includes('saturated') ||
              responseData.error.error.includes('è´Ÿè½½')
            ));
          
          const errorTitle = isLoadError ? 'âš ï¸ æœåŠ¡å™¨è´Ÿè½½é¥±å’Œï¼ˆå¯ç¨åé‡è¯•ï¼‰' : 'âŒ è¯·æ±‚å¤±è´¥';
          const errorMessage = isLoadError 
            ? 'è¿™æ˜¯æœåŠ¡å™¨ç«¯çš„æš‚æ—¶æ€§é—®é¢˜ï¼Œä¸æ˜¯é…ç½®é”™è¯¯ã€‚\n\nå»ºè®®ï¼š\n1. ç­‰å¾… 30 ç§’ - 2 åˆ†é’Ÿåé‡è¯•\n2. é”™å³°ä½¿ç”¨ï¼ˆé¿å¼€é«˜å³°æœŸï¼‰\n3. ä½ çš„ API é…ç½®æ˜¯æ­£ç¡®çš„ï¼'
            : 'è¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯';
          
          showResult('error', errorTitle, {
            status: response.status,
            statusText: response.statusText,
            error: responseData,
            requestBody: requestBody,
            message: errorMessage,
          });
        }
      } catch (error) {
        showResult('error', 'âŒ è¯·æ±‚å¼‚å¸¸', {
          message: error.message,
          error: error,
        });
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'ğŸš€ å¼€å§‹æµ‹è¯•';
      }
    });
    
    function showResult(type, title, data) {
      const resultDiv = document.getElementById('result');
      resultDiv.className = `result ${type}`;
      resultDiv.innerHTML = `
        <h3>${title}</h3>
        <pre>${JSON.stringify(data, null, 2)}</pre>
      `;
      resultDiv.style.display = 'block';
    }
    
    function clearResult() {
      document.getElementById('result').style.display = 'none';
    }
  </script>
</body>
</html>
